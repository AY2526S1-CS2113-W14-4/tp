@startuml
title Storage Save Operation - Sequence Diagram

participant ":InternityManager" as IM
participant "<<class>>\nInternshipList" as IL
participant ":Storage" as S
participant ":Internship" as Intern

IM -> IL: saveToStorage()
activate IL
IL -> S: save(List)
activate S

' === Directory check with nested activation ===
opt parent directory exists
    S -> S: Files.createDirectories(filePath.getParent())
    activate S
    S --> S: return
    deactivate S
end

' === Continue with save process ===
create ":PrintWriter" as PW
S -> PW**: new PrintWriter(filePath)
activate PW
return

S -> PW: println("Username (in line below):")
activate PW
PW --> S
deactivate PW
S -> IL: getUsername()
activate IL
IL --> S: return username
deactivate IL
S -> PW: println(username)
activate PW
PW --> S
deactivate PW

loop for each internship in List
    S -> Intern: get internship attributes\n(company, role, deadline, pay, status)
    activate Intern
    Intern --> S: return attributes
    deactivate Intern

    S -> S: format as "company | role | deadline | pay | status"
    activate S
    S --> S: return formatted string
    deactivate S

    S -> PW: println(formattedLine)
    activate PW
    PW --> S
    deactivate PW
end

S -> PW: close()
deactivate PW
destroy PW

S --> IL
deactivate S
IL --> IM
deactivate IL
@enduml
