@startuml
title Storage Save Operation - Sequence Diagram

participant ":InternityManager" as IM
participant "<<class>>\nInternshipList" as IL
participant ":Storage" as S
participant ":Internship" as Intern

IM -> IL: saveToStorage()
activate IL
IL -> S: save(List)
activate S

' === Directory check ===
S -> S: if (filePath.getParent() != null)
activate S
S -> S: Files.createDirectories(filePath.getParent())
S --> S: return
deactivate S

' === Create temp file ===
S -> S: tempFile = filePath.resolveSibling(filePath.getFileName() + ".tmp")
activate S
S --> S: return tempFile
deactivate S

' === Write to temp file ===
create ":PrintWriter" as PW
S -> PW**: new PrintWriter(tempFile)
activate PW
return

S -> PW: println("Username (in line below):")
activate PW
PW --> S
deactivate PW
S -> IL: getUsername()
activate IL
IL --> S: return username
deactivate IL
S -> PW: println(username)
activate PW
PW --> S
deactivate PW

loop for each internship in List
    S -> Intern: get internship attributes\n(company, role, deadline, pay, status)
    activate Intern
    Intern --> S: return attributes
    deactivate Intern

    S -> S: format as "company | role | deadline | pay | status"
    activate S
    S --> S: return formatted string
    deactivate S

    S -> PW: println(formattedLine)
    activate PW
    PW --> S
    deactivate PW
end

S -> PW: close()
deactivate PW
destroy PW

' === Atomic move ===
S -> S: try Files.move(tempFile, filePath, REPLACE_EXISTING, ATOMIC_MOVE)
activate S
alt AtomicMoveNotSupportedException
    S -> S: Files.move(tempFile, filePath, REPLACE_EXISTING)
    note right: Fallback: non-atomic move
end
S --> S: return
deactivate S

S --> IL
deactivate S
IL --> IM
deactivate IL
@enduml
